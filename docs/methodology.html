<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Methodology — Pramana</title>
  <meta name="description" content="Drift detection methodology: hash-based output consistency tracking.">
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <button class="nav-toggle" onclick="document.querySelector('nav').classList.toggle('open')">&#9776;</button>
  <div class="layout">
    <nav>
      <div class="logo">
        <a href="https://syd-ppt.github.io/pramana/">pramana</a>
        <span class="sanskrit">प्रमाण</span>
      </div>
      <ul>
        <li class="nav-section">CLI</li>
        <li><a href="https://syd-ppt.github.io/pramana/">Overview</a></li>
        <li><a href="https://syd-ppt.github.io/pramana/quickstart.html">Quick Start</a></li>
        <li><a href="https://syd-ppt.github.io/pramana/cli.html">CLI Reference</a></li>
        <li class="nav-section">API &amp; Dashboard</li>
        <li><a href="index.html">Overview</a></li>
        <li><a href="getting-started.html">Getting Started</a></li>
        <li><a href="api.html">API Reference</a></li>
        <li><a href="methodology.html" class="active">Methodology</a></li>
        <li class="nav-section">Internals</li>
        <li><a href="https://syd-ppt.github.io/pramana/architecture.html">Architecture</a></li>
        <li><a href="https://syd-ppt.github.io/pramana/providers.html">Providers</a></li>
        <li><a href="https://syd-ppt.github.io/pramana/suites.html">Test Suites</a></li>
        <li><a href="https://syd-ppt.github.io/pramana/reproducibility.html">Reproducibility</a></li>
        <li class="nav-section">Community</li>
        <li><a href="https://syd-ppt.github.io/pramana/contributing.html">Contributing</a></li>
      </ul>
      <div class="ext-links">
        <a href="https://github.com/syd-ppt/pramana">GitHub (CLI)</a>
        <a href="https://github.com/syd-ppt/pramana-api">GitHub (API)</a>
        <a href="https://pypi.org/project/pramana/">PyPI</a>
        <a href="https://pramana.pages.dev">Dashboard</a>
      </div>
    </nav>
    <main>
      <h1>Methodology</h1>
      <p class="page-desc">How Pramana detects LLM drift through output consistency tracking.</p>

      <h2>Core Principle</h2>
      <p>Each submission stores <code>output_hash = sha256(model_id | prompt_id | output)</code>. Same prompt + same model + different hash = the model's behavior changed. That's drift. No scoring needed.</p>

      <h2>Output Hash</h2>
      <p>Every submission computes a deterministic hash from three fields:</p>
      <div class="formula">
        output_hash = SHA-256(model_id + "|" + prompt_id + "|" + output)
      </div>
      <p>This hash is stored with each CSV record. It captures the exact output for a given (model, prompt) pair without storing raw outputs in the aggregated data.</p>

      <h2>Drift Detection</h2>
      <p>During daily aggregation, Pramana tracks the last-seen hash for each (model, prompt) pair. When a prompt's hash changes from one day to the next, it counts as a "drifted prompt."</p>

      <h3>Per-model, per-day statistics</h3>
      <table>
        <thead><tr><th>Metric</th><th>Definition</th></tr></thead>
        <tbody>
          <tr><td><code>submissions</code></td><td>Total submission records for this model on this day</td></tr>
          <tr><td><code>prompts_tested</code></td><td>Unique prompt IDs submitted</td></tr>
          <tr><td><code>unique_outputs</code></td><td>Unique output hashes observed</td></tr>
          <tr><td><code>drifted_prompts</code></td><td>Prompts whose hash differs from the previous day's hash</td></tr>
        </tbody>
      </table>

      <h2>Consistency Rate</h2>
      <div class="formula">
        consistency = (prompts_tested &minus; drifted_prompts) / prompts_tested
      </div>
      <p>A consistency rate of 1.0 means all tested prompts returned the same output as the previous day. A rate below 1.0 indicates drift.</p>

      <table>
        <thead><tr><th>Consistency</th><th>Status</th><th>Interpretation</th></tr></thead>
        <tbody>
          <tr><td>&ge; 95%</td><td>Stable</td><td>Model behavior is consistent</td></tr>
          <tr><td>80% – 95%</td><td>Watch</td><td>Some outputs have changed</td></tr>
          <tr><td>&lt; 80%</td><td>Drifting</td><td>Significant behavioral change detected</td></tr>
        </tbody>
      </table>

      <h2>Aggregation Pipeline</h2>
      <ol>
        <li>Parse all archive CSVs into flat record list</li>
        <li>Sort records by date</li>
        <li>Track <code>prevHash: Map&lt;model|prompt, hash&gt;</code> — last-seen hash per prompt</li>
        <li>Group records by (date, model)</li>
        <li>For each (date, model) group: compute submissions, prompts_tested, unique_outputs, drifted_prompts</li>
        <li>Store as <code>chart_data.json</code></li>
      </ol>

      <div class="callout">
        <strong>Privacy property:</strong> Only aggregate counts and hashes are stored in chart data. Individual outputs cannot be reconstructed from the aggregated statistics.
      </div>

      <h2>Badge Endpoint</h2>
      <p>The <code>/api/badge/:model</code> endpoint computes consistency over the last 7 days and returns an SVG badge:</p>
      <ul>
        <li>Green: &ge; 95% consistent</li>
        <li>Yellow: 80%–95% consistent</li>
        <li>Red: &lt; 80% consistent (drifting)</li>
      </ul>
    </main>
  </div>
</body>
</html>
